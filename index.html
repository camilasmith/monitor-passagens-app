<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Global de Passagens</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { 'brand': { '500': '#3b82f6', '600': '#2563eb' }, 'gray': { '850': '#182134', '950': '#0b111e' } } } } }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #cbd5e1; }
        .card-item { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .nav-btn.active { color: #3b82f6; background-color: #3b82f61a; }
    </style>
</head>
<body class="dark">

    <div class="flex h-screen bg-gray-950 text-slate-300">
        <!-- Menu Lateral -->
        <aside class="w-20 bg-gray-950 p-4 flex flex-col items-center border-r border-slate-800">
            <div class="text-brand-500 font-bold text-xl">S&R</div>
            <nav class="flex flex-col items-center gap-6 mt-12">
                <button id="nav-search" class="nav-btn p-3 rounded-xl hover:bg-slate-800 transition-colors" title="Buscar Voos">
                    <i data-lucide="search" class="w-6 h-6"></i>
                </button>
                <button id="nav-alerts" class="nav-btn p-3 rounded-xl hover:bg-slate-800 transition-colors" title="Meus Alertas">
                    <i data-lucide="bell" class="w-6 h-6"></i>
                </button>
                <button id="nav-settings" class="nav-btn p-3 rounded-xl hover:bg-slate-800 transition-colors" title="Configurações">
                    <i data-lucide="settings" class="w-6 h-6"></i>
                </button>
            </nav>
        </aside>

        <!-- Painel de Filtros -->
        <section class="w-full max-w-sm bg-slate-900 p-6 flex flex-col border-r border-slate-800">
            <h2 class="text-2xl font-bold text-white mb-6">Encontrar Oportunidades</h2>
            <form id="search-form" class="space-y-4 overflow-y-auto pr-2 flex-grow">
                <div>
                    <label class="text-sm font-medium">Origem / Destino</label>
                    <div class="flex flex-col gap-2 mt-1">
                        <input type="text" id="origin" placeholder="Origem (Obrigatório)" required class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 focus:ring-brand-500 focus:border-brand-500">
                        <input type="text" id="destination" placeholder="Destino (Opcional)" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 focus:ring-brand-500 focus:border-brand-500">
                    </div>
                     <p class="text-xs text-slate-500 mt-2">Deixe o destino em branco para explorar.</p>
                </div>
                <div>
                    <label class="text-sm font-medium">Datas</label>
                    <div class="flex gap-2 mt-1">
                        <input type="date" id="departureDate" required title="Data de Ida" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 focus:ring-brand-500 focus:border-brand-500">
                        <input type="date" id="returnDate" title="Data de Volta (Opcional)" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 focus:ring-brand-500 focus:border-brand-500">
                    </div>
                </div>
            </form>
             <div class="mt-4 pt-4 border-t border-slate-800">
                <button type="submit" form="search-form" class="w-full bg-brand-600 text-white font-bold py-3 rounded-lg hover:bg-brand-500 transition-all shadow-lg flex items-center justify-center">
                    <i data-lucide="search" class="w-5 h-5 mr-2"></i>Buscar Agora
                </button>
            </div>
        </section>

        <!-- Conteúdo Principal -->
        <main class="flex-1 p-6 lg:p-8 overflow-y-auto flex flex-col">
            <header class="flex justify-between items-center mb-6">
                 <div>
                    <h2 id="main-title" class="text-3xl font-bold text-white">Resultados da Busca</h2>
                    <span id="results-count" class="text-sm font-medium text-slate-400"></span>
                 </div>
                 <div class="flex items-center gap-2 text-sm text-slate-400">
                    <div id="status-indicator"></div>
                    <span id="status-text">Pronto para buscar.</span>
                </div>
            </header>

            <div id="panel-search-results">
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-white mb-4">🔥 Oportunidades Exclusivas</h3>
                    <div id="exclusive-feed" class="grid grid-cols-1 xl:grid-cols-2 2xl:grid-cols-3 gap-6">
                        <!-- Oportunidades exclusivas simuladas aparecerão aqui -->
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-white mb-4">Resultados da sua Busca</h3>
                    <div id="search-feed" class="grid grid-cols-1 xl:grid-cols-2 2xl:grid-cols-3 gap-6"></div>
                    <p id="feed-placeholder" class="text-center text-slate-500 col-span-full pt-16">Use o painel à esquerda para buscar uma rota.</p>
                </div>
            </div>
            
            <div id="panel-my-alerts" class="hidden space-y-4"></div>
            <div id="panel-settings" class="hidden"></div>
        </main>
    </div>
    
    <script>
        lucide.createIcons();

        const API_BASE_URL = 'https://monitor-passagens-server.onrender.com';
        
        const elements = {};
        ['nav-search', 'nav-alerts', 'nav-settings', 'search-form', 'main-title', 'panel-search-results', 'search-feed', 'exclusive-feed', 'panel-my-alerts', 'panel-settings', 'status-text', 'status-indicator', 'feed-placeholder', 'results-count'].forEach(id => {
            if (document.getElementById(id)) elements[id] = document.getElementById(id);
        });
        
        const defaultAirlinesData = { 'G3': { name: 'GOL', program: 'Smiles', mileValue: 18 },'LA': { name: 'LATAM', program: 'LATAM Pass', mileValue: 28 },'AD': { name: 'Azul', program: 'TudoAzul', mileValue: 22 },'TP': { name: 'TAP', program: 'Miles&Go', mileValue: 75 },'UA': { name: 'United', program: 'MileagePlus', mileValue: 120 },'AA': { name: 'American', program: 'AAdvantage', mileValue: 100 },'QR': { name: 'Qatar', program: 'Privilege Club', mileValue: 57 },'IB': { name: 'Iberia', program: 'Iberia Plus', mileValue: 90 },'BA': { name: 'British', program: 'Executive Club', mileValue: 90 }, 'AC': { name: 'Air Canada', program: 'Aeroplan', mileValue: 110 } };
        let airlinesData = { ...defaultAirlinesData };

        // SIMULAÇÃO DE OFERTAS EXCLUSIVAS QUE UM BACKEND AVANÇADO ENCONTRARIA
        const mockExclusiveDeals = [
            { airlineCode: 'QR', originCode: 'GRU', destinationCode: 'MLE', price: { miles: 85000 }, tripType: 'Ida e Volta', departureDate: '2025-11-10', info: 'Executiva (Qsuite)'},
            { airlineCode: 'TP', originCode: 'GIG', destinationCode: 'LIS', price: { cash: 1450.00 }, tripType: 'Só Ida', departureDate: '2026-02-15', info: 'Tarifa Light'},
            { airlineCode: 'IB', originCode: 'GRU', destinationCode: 'MAD', price: { miles: 42500 }, tripType: 'Só Ida', departureDate: '2025-12-05', info: 'Executiva (Promo)'},
        ];

        async function handleSearch(origin, destination, departureDate, returnDate) {
            elements['feed-placeholder'].style.display = 'none';
            elements['search-feed'].innerHTML = '';
            elements['results-count'].textContent = '';
            updateStatus(`Buscando...`, 'blue');

            try {
                // Lógica de busca existente...
                const params = new URLSearchParams({ origin });
                if (destination) params.append('destination', destination);
                if (departureDate) params.append('departureDate', departureDate);
                if (returnDate && destination) params.append('returnDate', returnDate);
                
                const endpoint = destination ? '/api/search-flights' : '/api/explore-deals';
                const response = await fetch(`${API_BASE_URL}${endpoint}?${params.toString()}`);
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                const responseData = await response.json();
                const offers = responseData.data || (Array.isArray(responseData) ? responseData : []);

                if (offers.length === 0) {
                    updateStatus(`Nenhuma oferta encontrada.`, 'gray');
                    elements['search-feed'].innerHTML = `<p class="text-center text-slate-500 col-span-full pt-8">Nenhuma oferta encontrada para sua busca.</p>`;
                    return;
                }
                
                const cardRenderer = destination ? renderFlightCard : renderExploreCard;
                elements['search-feed'].innerHTML = offers.map(cardRenderer).join('');
                elements['results-count'].textContent = `${offers.length} ofertas encontradas`;
                lucide.createIcons();
                updateStatus('Busca concluída!', 'green');

            } catch (error) {
                console.error("Falha ao buscar promoções:", error);
                updateStatus('Erro ao buscar. Verifique o console.', 'red');
            }
        }
        
        function renderFlightCard(flightData) { /* ...código existente sem alterações... */ }
        function renderExploreCard(dealData) { /* ...código existente sem alterações... */ }

        function renderExclusiveCard(deal) {
            const airlineInfo = airlinesData[deal.airlineCode] || { name: deal.airlineCode, program: 'N/A' };
            const isMiles = 'miles' in deal.price;
            const priceText = isMiles ? `${deal.price.miles.toLocaleString('pt-BR')} <span class="text-base font-normal">${airlineInfo.program}</span>` : `R$ ${deal.price.cash.toFixed(2)}`;
            const promoUrl = `https://www.google.com/flights#flt=${deal.originCode}.${deal.destinationCode}.${deal.departureDate}`;

            return `
                <div class="card-item bg-slate-900 border-2 border-amber-500/50 rounded-2xl shadow-lg flex flex-col relative overflow-hidden">
                    <div class="absolute top-2 right-2 text-xs font-bold uppercase px-2 py-1 rounded-full bg-amber-500/10 text-amber-400">🔥 Oportunidade</div>
                    <div class="p-5 flex flex-col flex-grow">
                        <div class="flex items-center gap-2 mb-4">
                            <img src="https://logo.clearbit.com/${airlineInfo.name.toLowerCase().replace(/\s/g, '')}.com" onerror="this.style.display='none'" class="h-6 w-6 rounded-full bg-slate-700"/>
                            <span class="text-sm font-semibold text-slate-300">${airlineInfo.name}</span>
                        </div>
                        <div class="text-center">
                            <div class="flex items-center justify-center gap-2 text-xl font-bold text-white">
                                <span>${deal.originCode}</span>
                                <i data-lucide="arrow-right" class="w-5 h-5 text-slate-500"></i>
                                <span>${deal.destinationCode}</span>
                            </div>
                            <div class="text-xs text-slate-400 mt-1">${deal.info} - ${deal.tripType}</div>
                        </div>
                        <div class="my-4 bg-slate-800/50 rounded-lg p-3 text-center">
                            <div class="text-2xl text-white font-bold">${priceText}</div>
                        </div>
                        <a href="${promoUrl}" target="_blank" class="mt-auto w-full bg-brand-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-brand-500 transition-colors flex items-center justify-center text-sm">Ver Detalhes</a>
                    </div>
                </div>
            `;
        }
        
        function renderMyAlerts() { /* ...código existente sem alterações... */ }
        function renderSettingsPanel() { /* ...código existente sem alterações... */ }
        function saveAirlinesDataToLocalStorage() { /* ...código existente sem alterações... */ }
        function loadAirlinesDataFromLocalStorage() { /* ...código existente sem alterações... */ }
        function saveAlertsToLocalStorage() { /* ...código existente sem alterações... */ }
        function loadAlertsFromLocalStorage() { /* ...código existente sem alterações... */ }
        
        // --- EVENTOS ---
        elements['search-form'].addEventListener('submit', (e) => { e.preventDefault(); const origin = document.getElementById('origin').value.toUpperCase().trim(); const dest = document.getElementById('destination').value.toUpperCase().trim(); const depDate = document.getElementById('departureDate').value; const retDate = document.getElementById('returnDate').value; if (origin) handleSearch(origin, dest, depDate, retDate); });
        
        // Código de navegação (sem alterações)
        const navButtons = [elements['nav-search'], elements['nav-alerts'], elements['nav-settings']];
        navButtons.forEach((button, index) => { button.addEventListener('click', () => { /* ... */ }); });
        
        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            elements['exclusive-feed'].innerHTML = mockExclusiveDeals.map(renderExclusiveCard).join('');
            lucide.createIcons();
            
            // Código de inicialização restante (sem alterações)
            loadAirlinesDataFromLocalStorage();
            loadAlertsFromLocalStorage();
            if (elements['nav-search']) elements['nav-search'].click();
        });
    </script>
</body>
</html>

